More functions for nested loop